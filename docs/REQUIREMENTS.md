# DBM 数据库管理工具 - 需求文档

## 一、项目背景

### 1.1 为什么做这个功能？

在日常开发和运维工作中，开发者和 DBA 需要管理多种类型的数据库（MySQL、PostgreSQL、SQLite、SQL Server、Oracle 等）。现有的数据库管理工具存在以下问题：

- **多工具切换**：不同数据库需要使用不同的管理工具，切换成本高
- **部署复杂**：许多工具需要复杂的安装配置，无法快速部署
- **跨平台限制**：某些工具只支持特定操作系统
- **团队协作**：团队缺乏统一的数据库管理工具

DBM 旨在提供一个**统一、轻量、跨平台**的数据库管理解决方案。

### 1.2 目标用户

| 用户类型 | 使用场景 | 核心诉求 |
|---------|---------|---------|
| **开发者** | 日常开发调试、数据查询修改 | 快速、易用、多数据库支持 |
| **DBA** | 数据库维护、性能监控、数据迁移 | 安全、可靠、监控能力 |

---

## 二、功能描述

### 2.1 整体功能架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                          DBM Web 界面                                 │
├──────┬──────────┬──────────────┬──────────┬──────────┬──────────────┤
│连接管│ SQL编辑器 │ 可视化构建器  │ 数据浏览  │数据导出  │    监控      │
│理    │          │              │与编辑    │          │              │
└──────┴──────────┴──────────────┴──────────┴──────────┴──────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        Go 后端服务                                    │
├──────────┬──────────┬──────────────┬──────────┬──────────────────────┤
│ 连接池   │ SQL执行  │ 密码加密     │ 导出引擎  │ Prometheus 指标      │
└──────────┴──────────┴──────────────┴──────────┴──────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────┐
│       MySQL │ PostgreSQL │ SQLite │ SQL Server │ Oracle             │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 核心功能模块

#### 模块一：连接管理

| 功能 | 描述 |
|-----|------|
| 连接配置 | 支持配置各类型数据库的连接参数（主机、端口、用户名、密码、数据库名等） |
| 连接保存 | 保存多个连接配置，支持命名和分组 |
| 密码加密 | 连接密码使用 AES 加密存储 |
| 连接测试 | 一键测试连接是否可用 |
| 连接切换 | 快速切换已保存的连接 |

#### 模块二：SQL 编辑器

| 功能 | 描述 |
|-----|------|
| 语法高亮 | 根据数据库类型提供对应 SQL 语法高亮 |
| 自动补全 | 表名、字段名智能提示 |
| 格式化 | SQL 代码美化格式化 |
| 多标签页 | 支持同时编辑多个 SQL |
| 执行控制 | 支持分步执行、事务控制 |

#### 模块三：可视化查询构建器

| 功能 | 描述 |
|-----|------|
| 表选择 | 拖拽选择要查询的表 |
| 字段选择 | 可视化勾选查询字段 |
| 关联配置 | 图形化配置表关联关系 |
| 条件设置 | 可视化设置 WHERE 条件 |
| SQL 预览 | 实时预览生成的 SQL |

#### 模块四：数据浏览与编辑

| 功能 | 描述 |
|-----|------|
| 表结构查看 | 查看表结构、索引、约束 |
| 数据浏览 | 分页展示表数据，支持万行级别 |
| 数据编辑 | 在线编辑单元格数据，支持 INSERT/UPDATE/DELETE |
| 数据过滤 | 快速设置过滤条件 |
| 数据排序 | 点击表头进行排序 |

#### 模块五：数据导出

| 功能 | 描述 |
|-----|------|
| **CSV 导出** | 将查询结果或整表数据导出为 CSV 文件 |
| **SQL 导出** | 导出为 INSERT 语句的 SQL 文件，支持数据迁移 |
| **自定义导出** | 支持选择导出字段、设置条件过滤 |
| **批量导出** | 支持批量选择多个表进行导出 |
| **导出进度** | 大数据量导出时显示进度条 |
| **编码设置** | 支持 UTF-8、GBK 等编码选择 |

**CSV 导出特性：**
- 支持自定义分隔符（逗号、分号、制表符）
- 支持引号包裹处理
- 支持表头包含/不包含
- 支持日期格式自定义

**SQL 导出特性：**
- 生成标准 INSERT 语句
- 支持批量 INSERT 优化（单语句多值）
- 自动处理特殊字符转义
- 支持包含/不包含建表语句
- 支持导出结构（CREATE TABLE）和数据分离

#### 模块六：数据库对象管理

| 功能 | 描述 |
|-----|------|
| 表管理 | 创建、修改、删除表，查看表详情 |
| 视图管理 | 创建、修改、删除视图 |
| 索引管理 | 查看和管理索引 |
| 存储过程 | 查看和执行存储过程 |
| 函数管理 | 查看和管理函数 |
| 触发器管理 | 查看和管理触发器 |

#### 模块七：监控功能

| 功能 | 描述 |
|-----|------|
| 指标暴露 | 通过 HTTP 端点暴露 Prometheus 格式指标 |
| 连接监控 | 当前活跃连接数、连接池状态 |
| 查询监控 | 查询次数、平均响应时间、慢查询统计 |
| 资源监控 | 内存使用、CPU 使用 |
| 数据库监控 | 各数据库连接状态、响应时间 |

---

## 三、用户场景

### 场景一：开发者日常查询与导出

> 作为开发者，我需要查询数据并导出给业务人员

1. 打开 DBM，选择已保存的数据库连接
2. 在 SQL 编辑器中编写查询语句
3. 执行查询，查看结果
4. 点击"导出"按钮，选择 CSV 格式
5. 设置导出参数（编码、分隔符等）
6. 下载 CSV 文件发送给业务人员

### 场景二：数据迁移（SQL 导出）

> 作为开发者，我需要将测试环境的数据迁移到开发环境

1. 连接到测试数据库
2. 选择需要迁移的表
3. 选择"SQL 导出"
4. 设置导出选项（包含建表语句 + 数据）
5. 生成 SQL 文件
6. 在开发环境执行该 SQL 文件

### 场景三：DBA 性能监控

> 作为 DBA，我需要监控多个数据库的健康状态

1. 配置多个生产库连接
2. 通过 Prometheus 端点（`/metrics`）获取监控数据
3. 在 Grafana 中查看监控面板
4. 发现异常后，连接到对应数据库进行诊断

### 场景四：批量数据备份

> 作为 DBA，我需要定期备份关键业务表

1. 选择需要备份的多个表
2. 选择"SQL 导出"
3. 设置导出为 INSERT 语句
4. 批量导出所有表
5. 保存为备份文件

---

## 四、功能清单

| 功能模块 | 功能点 | 优先级 | 用户价值 |
|---------|-------|-------|---------|
| 连接管理 | 多数据库连接配置 | P0 | 统一管理入口 |
| 连接管理 | 密码加密存储 | P0 | 安全保障 |
| 连接管理 | 连接测试 | P0 | 快速排障 |
| SQL 编辑器 | 语法高亮 | P0 | 提升编码体验 |
| SQL 编辑器 | 执行查询 | P0 | 核心功能 |
| SQL 编辑器 | 结果分页展示 | P0 | 支持大数据量 |
| 数据编辑 | 在线编辑数据 | P0 | 提高效率 |
| 数据编辑 | 增删改操作 | P0 | 完整 CRUD |
| **数据导出** | **CSV 导出** | **P0** | **数据交换** |
| **数据导出** | **SQL 导出** | **P0** | **数据迁移** |
| **数据导出** | **批量导出** | **P1** | **批量操作** |
| 可视化构建 | 拖拽式查询 | P1 | 降低使用门槛 |
| 对象管理 | 表结构查看 | P1 | 快速了解库结构 |
| 对象管理 | 对象 CRUD | P1 | 管理便利性 |
| SQL 编辑器 | 自动补全 | P1 | 提升编码效率 |
| SQL 编辑器 | 格式化 | P2 | 代码可读性 |
| 监控功能 | Prometheus 指标 | P1 | 运维可观测 |
| 监控功能 | 前端监控面板 | P2 | 可视化监控 |

---

## 五、非功能需求

### 5.1 性能要求

| 指标 | 要求 |
|-----|------|
| 查询响应时间 | 简单查询 < 1s，复杂查询 < 5s |
| 并发连接数 | 支持同时管理 10+ 个连接 |
| 结果集支持 | 支持万行级数据流畅展示 |
| 导出性能 | 万行数据导出 < 10s |
| 内存占用 | 空载 < 100MB，正常使用 < 500MB |

### 5.2 可用性要求

| 指标 | 要求 |
|-----|------|
| 部署方式 | 单可执行文件，无需额外依赖 |
| 启动时间 | < 3 秒 |
| 跨平台 | 支持 Linux、macOS、Windows |
| Web 界面 | 现代化、响应式设计 |

### 5.3 安全性要求

| 指标 | 要求 |
|-----|------|
| 密码存储 | AES-256 加密 |
| 传输加密 | 支持 HTTPS/SSL 连接数据库 |
| 导出安全 | 导出文件可选加密（未来扩展） |
| 访问控制 | 可选的登录认证（未来扩展） |

### 5.4 可扩展性要求

| 指标 | 要求 |
|-----|------|
| 数据库适配 | 插件化设计，便于新增数据库类型 |
| 功能扩展 | 模块化架构，便于添加新功能 |
| 导出格式 | 可扩展支持更多导出格式 |

---

## 六、技术约束

| 约束项 | 说明 |
|-------|------|
| 后端语言 | Go |
| 前端框架 | Vue.js |
| 部署方式 | 单文件可执行程序（前端嵌入） |
| 监控协议 | Prometheus |
| 支持系统 | Linux、macOS、Windows |

---

## 七、版本规划

### V1.0 - MVP 版本

- 连接管理（MySQL、PostgreSQL、SQLite）
- SQL 编辑器与执行
- 结果展示与分页
- 数据浏览与编辑
- 密码加密存储
- **CSV 导出**
- **SQL 导出**

### V1.1 - 功能增强

- SQL Server、Oracle 支持
- 可视化查询构建器
- SQL 自动补全
- 格式化功能
- 批量导出

### V1.2 - 监控与运维

- Prometheus 指标暴露
- 前端监控面板
- SQL 历史记录

### V2.0 - 高级特性

- SSH 隧道支持
- 数据库备份还原
- ER 图展示
- 多用户权限控制

---

## 八、成功标准

| 标准 | 度量方式 |
|-----|---------|
| 功能完整 | 支持 5+ 主流数据库，核心功能可用 |
| 性能达标 | 万行数据查询 < 3s，导出 < 10s |
| 部署便捷 | 单文件启动，无额外依赖 |
| 用户满意 | 团队内部使用反馈良好 |

---

*文档版本：v1.0*
*最后更新：2026-02-13*
