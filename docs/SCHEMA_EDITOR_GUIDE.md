# 表结构编辑器前端使用文档

## 功能概述

表结构编辑器是一个可视化的数据库表结构管理工具，支持通过图形界面进行表结构的增删改操作。

## 功能特性

### 1. 列管理
- ✅ 添加列
- ✅ 编辑列（修改类型、默认值、可空性等）
- ✅ 重命名列
- ✅ 删除列
- ✅ 支持多种数据类型
- ✅ 支持自增列（MySQL、SQLite）
- ✅ 支持列位置设置（MySQL、ClickHouse）

### 2. 索引管理
- ✅ 添加索引
- ✅ 删除索引
- ✅ 支持唯一索引
- ✅ 支持索引类型（BTREE、HASH）
- ✅ 支持复合索引

### 3. 表管理
- ✅ 重命名表
- ✅ 查看表信息

### 4. 批量操作
- ✅ 待执行操作队列
- ✅ 一次性执行多个变更
- ✅ 操作预览
- ✅ 操作撤销

### 5. 数据库特性适配
- ✅ 自动检测数据库类型
- ✅ 根据数据库类型显示/隐藏功能
- ✅ 数据类型选项自动适配
- ✅ 功能限制提示

## 使用流程

### 1. 进入编辑器

**方式一：从数据浏览页面**
1. 进入"数据浏览"页面
2. 选择连接和数据库
3. 点击表名查看表结构
4. 点击"编辑表结构"按钮

**方式二：直接访问**
```
/schema-editor?connectionId=xxx&database=xxx&table=xxx
```

### 2. 添加列

1. 点击"添加列"按钮
2. 填写列信息：
   - 列名（必填）
   - 数据类型（必填）
   - 长度/精度（根据类型）
   - 可空性
   - 默认值
   - 自增（如果支持）
   - 注释
   - 位置（如果支持）
3. 点击"确定"
4. 操作会添加到待执行队列

### 3. 编辑列

1. 在列表中找到要编辑的列
2. 点击"编辑"按钮
3. 修改列属性
4. 点击"确定"
5. 操作会添加到待执行队列

### 4. 重命名列

1. 在列表中找到要重命名的列
2. 点击"重命名"按钮
3. 输入新列名
4. 点击"确定"
5. 操作会添加到待执行队列

### 5. 删除列

1. 在列表中找到要删除的列
2. 点击"删除"按钮
3. 确认删除
4. 操作会添加到待执行队列

**注意**：SQLite 不支持删除列

### 6. 添加索引

1. 点击"添加索引"按钮
2. 填写索引信息：
   - 索引名（必填）
   - 索引列（必填，可多选）
   - 是否唯一索引
   - 索引类型（如果支持）
   - 注释
3. 点击"确定"
4. 操作会添加到待执行队列

**注意**：ClickHouse 不支持传统索引

### 7. 删除索引

1. 在索引列表中找到要删除的索引
2. 点击"删除"按钮
3. 确认删除
4. 操作会添加到待执行队列

**注意**：主键索引不能删除

### 8. 重命名表

1. 点击右上角"重命名表"按钮
2. 输入新表名
3. 点击"确定"
4. 立即执行（不进入待执行队列）

**注意**：ClickHouse 复制表的重命名不会通过 ZooKeeper 同步

### 9. 执行变更

1. 在"待执行操作"卡片中查看所有待执行的操作
2. 确认操作无误
3. 点击"执行变更"按钮
4. 确认执行
5. 等待执行完成
6. 表结构自动刷新

### 10. 管理待执行操作

- **移除单个操作**：点击操作右侧的"移除"按钮
- **清空所有操作**：点击"清空"按钮

## 数据类型支持

### MySQL
- **数值类型**：TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT, FLOAT, DOUBLE, DECIMAL
- **字符串类型**：CHAR, VARCHAR, TEXT, MEDIUMTEXT, LONGTEXT
- **日期时间**：DATE, TIME, DATETIME, TIMESTAMP, YEAR
- **其他**：BLOB, JSON, ENUM, SET

### PostgreSQL
- **数值类型**：SMALLINT, INTEGER, BIGINT, DECIMAL, NUMERIC, REAL, DOUBLE PRECISION
- **字符串类型**：CHAR, VARCHAR, TEXT
- **日期时间**：DATE, TIME, TIMESTAMP, INTERVAL
- **其他**：BOOLEAN, JSON, JSONB, UUID, BYTEA

### SQLite
- **基本类型**：INTEGER, REAL, TEXT, BLOB, NUMERIC

### ClickHouse
- **数值类型**：UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64, Float32, Float64
- **字符串类型**：String, FixedString
- **日期时间**：Date, DateTime, DateTime64
- **其他**：UUID, IPv4, IPv6

## 数据库特性对比

| 特性 | MySQL | PostgreSQL | SQLite | ClickHouse |
|------|-------|------------|--------|------------|
| 添加列 | ✅ | ✅ | ✅ | ✅ |
| 删除列 | ✅ | ✅ | ❌ | ✅ |
| 修改列 | ✅ | ✅ | ❌ | ✅ |
| 重命名列 | ✅ | ✅ | ✅ | ✅ |
| 添加索引 | ✅ | ✅ | ✅ | ❌ |
| 删除索引 | ✅ | ✅ | ✅ | ❌ |
| 重命名表 | ✅ | ✅ | ✅ | ✅* |
| 自增列 | ✅ | ✅ | ✅ | ❌ |
| 列位置 | ✅ | ❌ | ❌ | ✅ |
| 索引类型 | ✅ | ✅ | ❌ | ❌ |
| 批量操作 | ✅ | ❌ | ❌ | ✅ |

*ClickHouse 复制表的重命名不通过 ZooKeeper 同步

## 界面说明

### 表信息卡片
显示当前表的基本信息：
- 表名
- 数据库名
- 数据库类型

### 列管理卡片
显示表的所有列，支持：
- 查看列详情
- 添加新列
- 编辑列
- 重命名列
- 删除列

### 索引管理卡片
显示表的所有索引，支持：
- 查看索引详情
- 添加新索引
- 删除索引

### 待执行操作卡片
显示所有待执行的操作，支持：
- 查看操作详情
- 移除单个操作
- 清空所有操作
- 执行所有操作

## 注意事项

### ⚠️ 重要提示

1. **备份数据**：执行表结构变更前务必备份数据
2. **测试环境**：先在测试环境验证变更
3. **锁表影响**：大表变更可能锁表较长时间
4. **不可恢复**：表结构变更操作不可恢复

### SQLite 限制

- 不支持删除列
- 不支持修改列
- 仅支持添加列和重命名列

### ClickHouse 特别说明

- 不支持传统索引（使用 ORDER BY 和 PRIMARY KEY）
- 复制表的 ALTER 操作会通过 ZooKeeper 同步
- 复制表的 RENAME 操作不会通过 ZooKeeper 同步

### PostgreSQL 特别说明

- 修改列需要多条 ALTER 语句
- 不支持批量操作（每个操作单独执行）

## 快捷键

暂无快捷键支持

## 常见问题

### Q: 为什么某些功能按钮是禁用的？

A: 根据数据库类型的不同，某些功能可能不被支持。例如：
- ClickHouse 不支持传统索引
- SQLite 不支持删除列和修改列

### Q: 待执行操作可以撤销吗？

A: 在执行前可以移除或清空待执行操作。执行后无法撤销。

### Q: 为什么重命名表会立即执行？

A: 重命名表是一个独立的操作，不与其他表结构变更混合执行。

### Q: 如何查看执行的 SQL 语句？

A: 当前版本不显示 SQL 语句，可以在浏览器开发者工具的网络面板中查看请求。

### Q: 执行失败怎么办？

A: 检查错误信息，常见原因：
- 列名或索引名已存在
- 数据类型不兼容
- 违反约束条件
- 数据库权限不足

## 技术实现

### 前端技术栈
- Vue 3 + TypeScript
- Element Plus UI 组件库
- Vue Router 路由管理
- Pinia 状态管理
- Axios HTTP 客户端

### 核心组件
- `schema-editor.vue` - 主组件
- 列编辑对话框
- 索引编辑对话框
- 重命名对话框
- 待执行操作列表

### API 接口
- `POST /api/v1/connections/:id/tables/:table/alter` - 修改表结构
- `POST /api/v1/connections/:id/tables/:table/rename` - 重命名表
- `GET /api/v1/connections/:id/tables/:table/schema` - 获取表结构

## 后续优化

1. **SQL 预览**：显示将要执行的 SQL 语句
2. **历史记录**：记录表结构变更历史
3. **导入导出**：支持表结构的导入导出
4. **对比功能**：对比两个表的结构差异
5. **快捷键**：添加常用操作的快捷键
6. **拖拽排序**：支持拖拽调整列顺序
7. **批量编辑**：支持批量修改列属性
8. **模板功能**：保存和应用表结构模板